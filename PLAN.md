# План реализации программы ChatList

## Этап 1: Подготовка проекта и структуры

1.1. Создать структуру директорий проекта:
   - Создать основные директории (если необходимо)
   - Подготовить файловую структуру

1.2. Создать файл зависимостей:
   - Создать `requirements.txt` с необходимыми библиотеками:
     - PyQt5 или PyQt6
     - requests или httpx
     - python-dotenv (для работы с .env файлом)
     - sqlite3 (встроенная библиотека)

1.3. Создать файл конфигурации:
   - Создать `.env.example` с примером переменных окружения
   - Создать `.gitignore` для исключения `.env` и других служебных файлов

## Этап 2: Реализация базы данных

2.1. Создать модуль `db.py`:
   - Реализовать подключение к SQLite
   - Создать функции для инициализации базы данных
   - Создать таблицы: prompts, models, results, settings
   - Реализовать CRUD операции для каждой таблицы

2.2. Создать функции работы с таблицей `prompts`:
   - Добавление нового промта
   - Получение списка промтов
   - Поиск промтов по тегам
   - Сортировка промтов

2.3. Создать функции работы с таблицей `models`:
   - Добавление/редактирование модели
   - Получение списка активных моделей
   - Активация/деактивация модели
   - Поиск моделей

2.4. Создать функции работы с таблицей `results`:
   - Сохранение результатов
   - Получение сохраненных результатов
   - Поиск и сортировка результатов

2.5. Создать функции работы с таблицей `settings`:
   - Сохранение настроек
   - Загрузка настроек

## Этап 3: Реализация работы с API моделей

3.1. Создать модуль `network.py`:
   - Реализовать базовый класс для работы с API
   - Реализовать функции для отправки HTTP-запросов
   - Добавить обработку ошибок и таймаутов

3.2. Создать модуль `models.py`:
   - Реализовать базовый класс для работы с моделями
   - Реализовать поддержку разных типов API (OpenAI, DeepSeek, Groq и т.д.)
   - Реализовать функции для получения списка активных моделей из БД
   - Реализовать отправку промта в выбранные модели
   - Добавить асинхронную обработку запросов (опционально)

3.3. Интеграция с .env:
   - Реализовать загрузку API-ключей из .env файла
   - Реализовать маппинг имен переменных из БД на ключи в .env

## Этап 4: Реализация пользовательского интерфейса

4.1. Создать основной файл `main.py`:
   - Инициализировать PyQt приложение
   - Создать главное окно
   - Настроить базовую структуру интерфейса

4.2. Реализовать панель ввода промта:
   - Текстовое поле для ввода нового промта
   - Выпадающий список для выбора сохраненного промта
   - Кнопка отправки запроса
   - Поле для ввода/выбора тегов

4.3. Реализовать панель управления моделями:
   - Таблица со списком моделей
   - Чекбоксы для активации/деактивации моделей
   - Кнопки добавления/редактирования моделей
   - Поиск по моделям

4.4. Реализовать таблицу результатов:
   - Создать временную таблицу в памяти для отображения результатов
   - Колонки: название модели, текст ответа, чекбокс selected
   - Добавить индикатор загрузки во время отправки запросов
   - Реализовать обновление таблицы при получении ответов

4.5. Реализовать кнопки управления:
   - Кнопка "Сохранить" для сохранения выбранных результатов
   - Кнопка "Новый запрос" для очистки временной таблицы
   - Кнопка "Экспорт" для экспорта результатов (опционально)

## Этап 5: Интеграция компонентов

5.1. Связать интерфейс с базой данных:
   - Подключить загрузку промтов из БД в выпадающий список
   - Подключить сохранение новых промтов
   - Подключить загрузку списка моделей

5.2. Связать интерфейс с модулем работы с моделями:
   - Реализовать отправку промта при нажатии кнопки
   - Реализовать отображение результатов в таблице
   - Добавить обработку ошибок при запросах

5.3. Реализовать логику сохранения результатов:
   - При нажатии "Сохранить" собрать все строки с selected=True
   - Сохранить их в таблицу results
   - Очистить временную таблицу

5.4. Реализовать логику нового запроса:
   - При вводе нового промта очистить временную таблицу
   - Создать новую таблицу после получения ответов

## Этап 6: Дополнительные функции

6.1. Реализовать поиск и сортировку:
   - Поиск в таблице промтов
   - Поиск в таблице моделей
   - Поиск в таблице результатов
   - Сортировка по всем колонкам

6.2. Реализовать экспорт результатов:
   - Экспорт в Markdown формат
   - Экспорт в JSON формат
   - Выбор файла для сохранения

6.3. Реализовать логирование:
   - Создать модуль для логирования запросов
   - Логировать все запросы к API
   - Логировать ошибки и исключения

6.4. Реализовать настройки программы:
   - Интерфейс для управления настройками
   - Сохранение настроек в БД

## Этап 7: Реализация функции "AI-ассистент для улучшения промтов"

7.1. Создать модуль для обработки улучшения промтов:
   - Создать класс `PromptImprover` в модуле `prompt_improver.py`
   - Реализовать метод для отправки промта в указанную модель через существующий OpenRouter-клиент
   - Реализовать парсинг ответа от модели для извлечения улучшенной версии и альтернативных вариантов

7.2. Реализовать промт-шаблоны для улучшения:
   - Создать промт-шаблон для запроса улучшенной версии промта
   - Создать промт-шаблон для генерации 2–3 вариантов переформулировки
   - Создать промт-шаблоны для адаптации промта под разные типы (код, анализ, креатив)
   - Реализовать формирование структурированного запроса к модели

7.3. Создать диалоговое окно для отображения результатов улучшения:
   - Создать класс `PromptImprovementDialog(QDialog)` в `main.py`
   - Реализовать отображение исходного промта
   - Реализовать отображение улучшенной версии промта
   - Реализовать отображение альтернативных вариантов (2–3 варианта)
   - Добавить кнопку "Подставить в поле ввода" для каждого варианта
   - Реализовать выбор модели для улучшения (выпадающий список с активными моделями)

7.4. Реализовать UI-элементы в главном окне:
   - Добавить кнопку "Улучшить промт" рядом с полем ввода промта
   - Связать кнопку с открытием диалога улучшения промтов
   - Реализовать передачу текущего текста из поля ввода в диалог
   - Реализовать подстановку выбранного варианта обратно в поле ввода

7.5. Реализовать поток для асинхронного улучшения промта:
   - Создать класс `ImprovePromptThread(QThread)` в `main.py`
   - Реализовать асинхронную отправку запроса к модели
   - Реализовать обработку ответа и извлечение вариантов
   - Добавить сигналы для обновления UI при получении результатов
   - Добавить индикатор загрузки во время обработки

7.6. Реализовать обработку ошибок:
   - Добавить обработку ошибок API при запросе улучшения
   - Добавить валидацию входных данных (проверка на пустой промт)
   - Реализовать отображение ошибок пользователю
   - Добавить логирование ошибок через существующий Logger

7.7. Интеграция с существующими модулями:
   - Использовать `ModelHandler` для отправки запросов
   - Использовать `Database` для получения списка моделей
   - Использовать существующий механизм работы с API-ключами из .env
   - Использовать существующий `Logger` для логирования

7.8. Оптимизация пользовательского опыта:
   - Добавить возможность копировать вариант в буфер обмена
   - Реализовать предпросмотр промта перед подстановкой
   - Добавить сохранение истории улучшений (опционально)
   - Реализовать адаптацию промта под разные типы моделей с помощью чекбоксов/радиокнопок

## Этап 8: Тестирование и отладка

8.1. Тестирование работы с базой данных:
   - Проверить создание таблиц
   - Проверить CRUD операции
   - Проверить целостность данных

8.2. Тестирование работы с API:
   - Проверить отправку запросов к разным моделям
   - Проверить обработку ошибок
   - Проверить таймауты

8.3. Тестирование интерфейса:
   - Проверить все элементы интерфейса
   - Проверить взаимодействие компонентов
   - Проверить обработку пользовательских действий

8.4. Интеграционное тестирование:
   - Проверить полный цикл работы программы
   - Проверить сохранение и загрузку данных
   - Проверить работу с несколькими моделями одновременно

## Этап 9: Оптимизация и финализация

9.1. Оптимизация производительности:
   - Оптимизировать запросы к БД
   - Оптимизировать работу с API (асинхронность)
   - Оптимизировать обновление интерфейса

9.2. Улучшение пользовательского опыта:
   - Добавить подсказки и tooltips
   - Улучшить обработку ошибок с понятными сообщениями
   - Добавить валидацию ввода

9.3. Документация:
   - Создать README.md с инструкциями по установке и использованию
   - Добавить комментарии в код
   - Создать примеры использования

9.4. Финальная проверка:
   - Проверить соответствие спецификации
   - Убедиться в отсутствии критических ошибок
   - Подготовить к использованию

